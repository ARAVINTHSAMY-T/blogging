<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile | BlogSpace</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      /* Light theme (default) */
      --primary-color: #1d1d1f;
      --secondary-color: #86868b;
      --accent-color: #0071e3;
      --accent-hover: #0077ed;
      --background: #f5f5f7;
      --card-bg: #ffffff;
      --text-primary: #1d1d1f;
      --text-secondary: #515154;
      --text-tertiary: #86868b;
      --border-color: #d2d2d7;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.07);
      --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    /* Dark theme */
    [data-theme="dark"] {
      --primary-color: #f5f5f7;
      --secondary-color: #86868b;
      --accent-color: #0071e3;
      --accent-hover: #0077ed;
      --background: #1d1d1f;
      --card-bg: #2d2d2f;
      --text-primary: #f5f5f7;
      --text-secondary: #a1a1a6;
      --text-tertiary: #86868b;
      --border-color: #424245;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    [data-theme="dark"] header {
      background: rgba(45, 45, 47, 0.8);
    }

    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 90%;
      max-width: 1200px;
      margin: auto;
    }

    .brand {
      font-size: 24px;
      font-weight: 700;
      text-decoration: none;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand i {
      color: var(--accent-color);
    }

    .nav-links {
      display: flex;
      gap: 30px;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 17px;
      transition: var(--transition);
      position: relative;
    }

    .nav-links a:hover {
      color: var(--text-primary);
    }

    .nav-links a.active {
      color: var(--text-primary);
    }

    .nav-links a.active::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--accent-color);
    }

    .profile-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(0, 0, 0, 0.03);
      padding: 8px 16px;
      border-radius: 20px;
      color: var(--text-primary);
      font-weight: 500;
      transition: var(--transition);
    }

    .profile-bar:hover {
      background: rgba(0, 0, 0, 0.06);
    }

    .profile-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      border: 1px solid var(--border-color);
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-primary);
      font-size: 18px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: var(--transition);
      margin-left: 10px;
    }

    .theme-toggle:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .theme-toggle {
      color: var(--text-primary);
    }

    main {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 60px 20px;
      flex: 1;
    }

    .profile-container {
      background: var(--card-bg);
      padding: 40px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 500px;
      text-align: center;
      transition: var(--transition);
    }

    .profile-container:hover {
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    h2 {
      color: var(--accent-color);
      font-weight: 700;
      font-size: 32px;
      margin-bottom: 30px;
      letter-spacing: -0.5px;
    }

    #profileAvatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--accent-color);
      margin-bottom: 25px;
      transition: var(--transition);
    }

    #profileAvatar:hover {
      transform: scale(1.05);
    }

    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: var(--accent-color);
      border-radius: 12px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: 17px;
      transition: var(--transition);
      border: none;
      cursor: pointer;
      margin-bottom: 15px;
    }

    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: rgba(0, 0, 0, 0.03);
      color: var(--text-primary);
    }

    /* Hide file input default label */
    input[type="file"]::-webkit-file-upload-button {
      visibility: hidden;
    }
    input[type="file"]::file-selector-button {
      visibility: hidden;
    }
    input[type="file"] {
      font-size: 0;
    }

    /* Custom file input label */
    .custom-file-label {
      display: none;
      margin-bottom: 15px;
      color: white;
      background: var(--accent-color);
      font-weight: 600;
      font-size: 16px;
      border-radius: 12px;
      padding: 12px 24px;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      text-align: center;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }

    .custom-file-label.show-label {
      display: block;
    }

    .custom-file-label:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
    }

    #customNameInput {
      width: 100%;
      margin-top: 8px;
      margin-bottom: 20px;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      font-size: 16px;
      background: var(--background);
      color: var(--text-primary);
      transition: var(--transition);
      font-family: inherit;
    }

    #customNameInput::placeholder {
      color: var(--text-tertiary);
    }

    #customNameInput:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
    }

    #customNameInput:disabled {
      background: var(--background);
      color: var(--text-secondary);
    }

    #aboutInput {
      width: 100%;
      margin-top: 8px;
      margin-bottom: 20px;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      font-size: 16px;
      background: var(--background);
      color: var(--text-primary);
      resize: vertical;
      transition: var(--transition);
      font-family: inherit;
      min-height: 100px;
    }

    #aboutInput::placeholder {
      color: var(--text-tertiary);
    }

    #aboutInput:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
    }

    #aboutInput:disabled {
      background: var(--background);
      color: var(--text-secondary);
    }

    #aboutDisplay {
      color: var(--text-secondary);
      margin-top: 20px;
      font-size: 16px;
      line-height: 1.6;
      padding: 20px;
      background: var(--background);
      border-radius: 12px;
      text-align: left;
    }

    label[for="aboutInput"], label[for="customNameInput"] {
      color: var(--text-primary);
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
      text-align: left;
      font-size: 17px;
    }

    #profileUser {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--text-primary);
    }

    .form-group {
      margin-bottom: 25px;
      text-align: left;
    }

    footer {
      background: var(--primary-color);
      color: var(--text-tertiary);
      text-align: center;
      padding: 40px 20px;
      margin-top: auto;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }

    .footer-links a {
      color: var(--text-tertiary);
      text-decoration: none;
      transition: var(--transition);
    }

    .footer-links a:hover {
      color: white;
    }

    .copyright {
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .nav {
        flex-direction: column;
        gap: 20px;
      }
      
      .nav-links {
        gap: 20px;
      }
      
      .profile-container {
        padding: 30px 25px;
        margin: 20px;
      }
      
      h2 {
        font-size: 28px;
      }
    }

    @media (max-width: 576px) {
      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .footer-links {
        flex-direction: column;
        gap: 15px;
      }
      
      #profileAvatar {
        width: 100px;
        height: 100px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <a class="brand" href="home.html">
        <i class="fas fa-apple-alt"></i>
        BlogSpace
      </a>
      <nav class="nav-links">
        <a href="home.html">Home</a>
        <a href="post.html">Posts</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="profile.html" class="active">Profile</a>
      </nav>
      <div class="profile-bar">
        <img id="profileBarAvatar" class="profile-avatar" src="https://ui-avatars.com/api/?name=User&background=0071e3&color=fff" alt="Profile">
        <a id="profileName" href="profile.html" style="color:inherit;text-decoration:none;">User</a>
        <a href="#" id="logoutBtn" style="color:inherit;margin-left:10px;">
          <i class="fas fa-sign-out-alt"></i>
        </a>
      </div>
      <button id="themeToggle" class="theme-toggle" title="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <main>
    <div class="profile-container">
      <h2>Profile</h2>
      <div>
        <div style="display:flex;justify-content:center;">
          <img id="profileAvatar" class="profile-avatar" src="https://ui-avatars.com/api/?name=User&background=0071e3&color=fff" alt="Profile">
        </div>
        <button class="btn" id="editBtn">Edit Profile</button>
        <label id="profilePhotoLabel" for="avatarInput" class="custom-file-label">
          <i class="fas fa-camera"></i> Change Profile Photo
        </label>
        <input type="file" id="avatarInput" accept="image/*" style="display:none;">
        <button class="btn" id="saveBtn" style="display:none;">Save Changes</button>
        
        <div class="form-group">
          <label for="customNameInput">Display Name</label>
          <input type="text" id="customNameInput" placeholder="Enter your display name" disabled>
        </div>
        
        <div id="profileUser"></div>
        
        <div class="form-group">
          <label for="aboutInput">About Me</label>
          <textarea id="aboutInput" placeholder="Tell us something about yourself..." disabled></textarea>
        </div>
        
        <div id="aboutDisplay"></div>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-links">
        <a href="home.html">Home</a>
        <a href="post.html">Posts</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="profile.html">Profile</a>
      </div>
      <p class="copyright">© 2025 BlogSpace • Crafted by developers</p>
    </div>
  </footer>

  <script>
    // Show logged in user name and avatar
    const user = localStorage.getItem('loggedInUser');
    const customName = localStorage.getItem('customName');
    const avatarImg = document.getElementById('profileAvatar');
    const avatarBarImg = document.getElementById('profileBarAvatar');
    const profileName = document.getElementById('profileName');
    const profileUser = document.getElementById('profileUser');
    const customNameInput = document.getElementById('customNameInput');

    // Set display name
    if (customName) {
      profileName.textContent = customName;
      profileUser.textContent = customName;
      customNameInput.value = customName;
    } else if (user) {
      profileName.textContent = user;
      profileUser.textContent = user;
      customNameInput.value = user;
    } else {
      profileName.textContent = 'User';
      profileUser.textContent = 'User';
      customNameInput.value = 'User';
    }

    // Set avatar
    const avatar = localStorage.getItem('profileAvatar');
    const avatarName = customName || user || 'User';
    if (avatar) {
      avatarImg.src = avatar;
      avatarBarImg.src = avatar;
    } else {
      avatarImg.src = `https://ui-avatars.com/api/?name=${avatarName}&background=0071e3&color=fff`;
      avatarBarImg.src = `https://ui-avatars.com/api/?name=${avatarName}&background=0071e3&color=fff`;
    }

    // Load about info from localStorage
    const about = localStorage.getItem('profileAbout');
    if (about) {
      document.getElementById('aboutInput').value = about;
      document.getElementById('aboutDisplay').textContent = about;
    }

    // Edit button logic
    const editBtn = document.getElementById('editBtn');
    const avatarInput = document.getElementById('avatarInput');
    const saveBtn = document.getElementById('saveBtn');
    const aboutInput = document.getElementById('aboutInput');
    const profilePhotoLabel = document.getElementById('profilePhotoLabel');

    editBtn.onclick = function() {
      avatarInput.style.display = 'block';
      saveBtn.style.display = 'inline-block';
      aboutInput.disabled = false;
      customNameInput.disabled = false;
      editBtn.style.display = 'none';
      profilePhotoLabel.classList.add('show-label');
    };

    // Save button logic
    saveBtn.onclick = function() {
      // Save custom name
      const customNameText = customNameInput.value.trim();
      if (customNameText) {
        localStorage.setItem('customName', customNameText);
        profileName.textContent = customNameText;
        profileUser.textContent = customNameText;
      } else {
        localStorage.removeItem('customName');
        profileName.textContent = user || 'User';
        profileUser.textContent = user || 'User';
      }

      // Save about info
      const aboutText = aboutInput.value.trim();
      localStorage.setItem('profileAbout', aboutText);
      document.getElementById('aboutDisplay').textContent = aboutText;

      // Save profile photo if changed
      if (avatarInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          localStorage.setItem('profileAvatar', evt.target.result);
          avatarImg.src = evt.target.result;
          avatarBarImg.src = evt.target.result; // Update top left avatar

          // Reset UI
          resetProfileUI();

          // Notify other pages about profile update (with uploaded photo)
          const profileChannel = new BroadcastChannel('profile-updates');
          profileChannel.postMessage({
            type: 'profile-updated',
            data: {
              customName: customNameText || user || 'User', // Always send the effective display name
              avatar: evt.target.result, // Send the actual image data
              about: aboutText
            }
          });
          profileChannel.close();
        };
        reader.readAsDataURL(avatarInput.files[0]);
      }

      // Update avatar URL if no photo is uploaded
      if (!avatarInput.files[0]) {
        const avatarName = customNameText || user || 'User';
        const avatarUrl = `https://ui-avatars.com/api/?name=${avatarName}&background=0071e3&color=fff`;
        avatarImg.src = avatarUrl;
        avatarBarImg.src = avatarUrl;

        // Reset UI
        resetProfileUI();

        // Notify other pages about profile update (with generated avatar)
        const profileChannel = new BroadcastChannel('profile-updates');
        profileChannel.postMessage({
          type: 'profile-updated',
          data: {
            customName: customNameText || user || 'User', // Always send the effective display name
            avatar: avatarUrl,
            about: aboutText
          }
        });
        profileChannel.close();
      }

      // Helper function to reset profile UI
      function resetProfileUI() {
        avatarInput.value = '';
        avatarInput.style.display = 'none';
        saveBtn.style.display = 'none';
        aboutInput.disabled = true;
        customNameInput.disabled = true;
        editBtn.style.display = 'inline-block';
        profilePhotoLabel.classList.remove('show-label');
      }
    };

    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;

    // Check for saved theme preference or default to light mode
    const currentTheme = localStorage.getItem('theme') || 'light';
    html.setAttribute('data-theme', currentTheme);

    // Update button icon based on current theme
    function updateThemeIcon() {
      const icon = themeToggle.querySelector('i');
      if (html.getAttribute('data-theme') === 'dark') {
        icon.className = 'fas fa-sun';
      } else {
        icon.className = 'fas fa-moon';
      }
    }

    updateThemeIcon();

    // Toggle theme
    themeToggle.addEventListener('click', () => {
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon();
    });

    // Logout button logic
    document.getElementById("logoutBtn").addEventListener("click", function(e) {
      e.preventDefault();
      (async () => {
        try {
          const module = await import('./auth.js');
          await module.logout();
        } catch (_) {}
        localStorage.removeItem("loggedInUser");
        localStorage.removeItem("customName");
        localStorage.removeItem("profileAvatar");
        localStorage.removeItem("profileAbout");
        window.location.href = "first_page.html";
      })();
    });
  </script>
</body>
</html>